(()=>{"use strict";var e,t={6330:(e,t,i)=>{const r=i(6206),n=i(7093);"Game"==window.name?new n.GameWorld("Assets/World.json"):new r.GameEditor("Assets/World.json"),document.addEventListener("keydown",(function(e){"1"==e.key&&("Game"==window.name?window.name="Editor":window.name="Game",location.reload())}),!1)},4400:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FollowCamera=t.PerspectiveCamera=void 0;var r=i(7010);Object.defineProperty(t,"PerspectiveCamera",{enumerable:!0,get:function(){return r.PerspectiveCamera}});var n=i(8551);Object.defineProperty(t,"FollowCamera",{enumerable:!0,get:function(){return n.FollowCamera}})},8551:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FollowCamera=void 0;const r=i(4400),n=i(293);class FollowCamera extends n.Component{constructor(){super(...arguments),this.cameraInitialPosition=null,this.playerTransform=null,this.mainCamera=null,this.onAwake=()=>{var e,t=null===(e=n.GameObject.findWithTag("Player"))||void 0===e?void 0:e.getComponent(n.Transform);t&&(this.playerTransform=t),this.mainCamera=this.getComponent(r.PerspectiveCamera)},this.onLateUpdate=()=>{this.initCameraPosition(),this.follow()}}initCameraPosition(){if(!this.cameraInitialPosition){if(!this.mainCamera)return;this.cameraInitialPosition=this.mainCamera.getPosition()}}follow(){if(this.playerTransform&&this.mainCamera&&this.cameraInitialPosition){var e=this.mainCamera.getPosition();if(e){var t=this.playerTransform.getPosition();e.x=t.x,e.y=this.cameraInitialPosition.y+t.y,this.mainCamera.setPosition(e),this.mainCamera.lookAt(t)}}}}t.FollowCamera=FollowCamera},7010:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PerspectiveCamera=void 0;const r=i(5232),n=i(293);class PerspectiveCamera extends n.RenderableObject{constructor(){super(...arguments),this.fieldOfView=75,this.near=1,this.far=3e4,this.camera=null,this.onAwake=()=>{this.camera=new r.PerspectiveCamera(this.fieldOfView,window.innerWidth/window.innerHeight,this.near,this.far),this.object=this.camera}}getCamera(){return this.camera}lookAt(e){this.object&&this.object.lookAt(e.x,e.y,e.z)}serialize(){return this.toObject()}deserialize(e){const t=e;this.fieldOfView=t.fieldOfView,this.near=t.near,this.far=t.far}toObject(){return{fieldOfView:this.fieldOfView,near:this.near,far:this.far}}}t.PerspectiveCamera=PerspectiveCamera},2508:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerController=void 0;var r=i(4999);Object.defineProperty(t,"PlayerController",{enumerable:!0,get:function(){return r.PlayerController}})},4999:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerController=void 0;const r=i(293),n=i(7158);let o=!1,a=!1,s=!1,d=!1,l=!1;class PlayerController extends r.Component{constructor(){super(...arguments),this.mover=null,this.onAwake=()=>{document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),this.mover=this.getComponent(n.Mover)},this.onUpdate=()=>{null!=this.mover&&(d?this.mover.startMove(n.MoveDirection.Forward):a?this.mover.startMove(n.MoveDirection.Backward):this.mover.stopMove(),l&&(this.mover.jump(),l=!1))}}onKeyDown(e){"w"==e.key?o=!0:"s"==e.key?s=!0:"a"==e.key?a=!0:"d"==e.key?d=!0:" "==e.key&&(l=!0)}onKeyUp(e){"w"==e.key?o=!1:"s"==e.key?s=!1:"a"==e.key?a=!1:"d"==e.key&&(d=!1)}}t.PlayerController=PlayerController},293:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=t.Time=t.RigidBody=t.Quaternion=t.Position=t.Mesh=t.RenderableObject=t.GameObject=t.EventManager=t.Component=t.Scale=void 0;var r=i(3515);Object.defineProperty(t,"Scale",{enumerable:!0,get:function(){return r.Scale}});var n=i(8755);Object.defineProperty(t,"Component",{enumerable:!0,get:function(){return n.Component}});var o=i(4309);Object.defineProperty(t,"EventManager",{enumerable:!0,get:function(){return o.EventManager}});var a=i(6350);Object.defineProperty(t,"GameObject",{enumerable:!0,get:function(){return a.GameObject}});var s=i(11);Object.defineProperty(t,"RenderableObject",{enumerable:!0,get:function(){return s.RenderableObject}});var d=i(4165);Object.defineProperty(t,"Mesh",{enumerable:!0,get:function(){return d.Mesh}});var l=i(789);Object.defineProperty(t,"Position",{enumerable:!0,get:function(){return l.Position}});var c=i(4228);Object.defineProperty(t,"Quaternion",{enumerable:!0,get:function(){return c.Quaternion}});var h=i(5983);Object.defineProperty(t,"RigidBody",{enumerable:!0,get:function(){return h.RigidBody}});var u=i(5646);Object.defineProperty(t,"Time",{enumerable:!0,get:function(){return u.Time}});var m=i(1086);Object.defineProperty(t,"Transform",{enumerable:!0,get:function(){return m.Transform}})},8755:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;const r=i(293);t.Component=class Component{constructor(){this.gameObject=new r.GameObject,this.isEnabled=!0,this.onAwake=()=>{},this.onStart=()=>{},this.onUpdate=()=>{},this.onLateUpdate=()=>{}}setup(e){this.gameObject=e,r.EventManager.getSystem().subscribe("Awake",this.onAwake),r.EventManager.getSystem().subscribe("Start",this.onStart),r.EventManager.getSystem().subscribe("Update",this.onUpdate),r.EventManager.getSystem().subscribe("LateUpdate",this.onLateUpdate)}disable(){this.isEnabled=!1,r.EventManager.getSystem().unsubscribe("Awake",this.onAwake),r.EventManager.getSystem().unsubscribe("Start",this.onStart),r.EventManager.getSystem().unsubscribe("Update",this.onUpdate),r.EventManager.getSystem().unsubscribe("LateUpdate",this.onLateUpdate)}getComponent(e){return this.gameObject.getComponent(e)}serialize(){return null}deserialize(e){}}},4309:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=void 0;const r=i(8675);t.EventManager=class EventManager{static getSystem(){return this.eventSystem||(this.eventSystem=new r.default),this.eventSystem}}},6350:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameObject=void 0;const r=i(8675),n=i(293);class GameObject{constructor(){this.name="GameObject",this.tag="",this.components=new Array}setup(){GameObject.gameObjects.push(this),this.addComponent(new n.Transform),this.addComponents()}static findWithTag(e){var t=null;return this.gameObjects.forEach((i=>{i.tag==e&&(t=i)})),t}getComponent(e){let t=null;return this.components.forEach((i=>{let r=Object.getPrototypeOf(i);for(;r instanceof n.Component;)r.constructor.name===e.name&&(t=i),r=Object.getPrototypeOf(r)})),t||null}addComponent(e){e.setup(this),this.components.push(e)}getTag(){return this.tag}disable(){this.components.forEach((e=>{e.disable()}))}static destroy(e){var t=GameObject.gameObjects.indexOf(e);GameObject.gameObjects.splice(t,1),GameObject.event.notify("OnDestroy",e)}serialize(){let e=new Array;return e.push({GameObject:this.toObject()}),this.components.forEach((t=>{let i=t.serialize();i&&e.push({[t.constructor.name]:i})})),e.length>0?e:null}deserialize(e){e.forEach((e=>{Object.keys(e).forEach((t=>{var i;if("GameObject"==t){const i=e[t];this.name=i.name,this.tag=i.tag}else null===(i=this.getComponentByString(t))||void 0===i||i.deserialize(e[t])}))}))}toObject(){return{name:this.name,tag:this.tag,prefab:this.constructor.name}}getComponentByString(e){let t=null;return this.components.forEach((i=>{i.constructor.name===e&&(t=i)})),t||null}draw(){}addComponents(){}}t.GameObject=GameObject,GameObject.event=new r.default,GameObject.gameObjects=new Array},4165:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mesh=void 0;const r=i(293);class Mesh extends r.RenderableObject{constructor(){super(...arguments),this.mesh=null}}t.Mesh=Mesh},789:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Position=void 0;t.Position=class Position{constructor(){this.x=0,this.y=0,this.z=0}serialize(){return this.toObject()}deserialize(e){const t=e;this.x=t.x,this.y=t.y,this.z=t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}},4228:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Quaternion=void 0;t.Quaternion=class Quaternion{constructor(){this.x=0,this.y=0,this.z=0,this.w=0}serialize(){return this.toObject()}deserialize(e){const t=e;this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}},11:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderableObject=void 0;const r=i(293);class RenderableObject extends r.Component{constructor(){super(...arguments),this.object=null}getObject(){return this.object}setPosition(e){var t;null===(t=this.object)||void 0===t||t.position.set(e.x,e.y,e.z)}setScale(e){var t;null===(t=this.object)||void 0===t||t.scale.set(e.x,e.y,e.z)}setQuaternion(e){var t;null===(t=this.object)||void 0===t||t.quaternion.set(e.x,e.y,e.z,e.w)}getPosition(){if(!this.object)return null;var e=new r.Position;return e.x=this.object.position.x,e.y=this.object.position.y,e.z=this.object.position.z,e}getScale(){if(!this.object)return null;var e=new r.Scale;return e.x=this.object.scale.x,e.y=this.object.scale.y,e.z=this.object.scale.z,e}getQuaternion(){if(!this.object)return null;var e=new r.Quaternion;return e.x=this.object.quaternion.x,e.y=this.object.quaternion.y,e.z=this.object.quaternion.z,e.w=this.object.quaternion.w,e}}t.RenderableObject=RenderableObject},5983:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RigidBody=void 0;const r=i(3687),n=i(5264),o=i(293);class RigidBody extends o.Component{constructor(){super(...arguments),this.mass=0,this.bodyType="STATIC",this.rigidBody=null,this.shape=null,this.meshComponent=null,this.onAwake=()=>{this.meshComponent=this.getComponent(o.Mesh)},this.onStart=()=>{var e;let t=null===(e=this.meshComponent)||void 0===e?void 0:e.getObject();if(!t)return;let i=this.getBodyType(),o=n.threeToCannon(t);(null==o?void 0:o.shape)&&(this.shape=null==o?void 0:o.shape),this.shape&&(this.rigidBody=new r.Body({mass:this.mass,type:i,shape:this.shape,position:null==o?void 0:o.offset,quaternion:null==o?void 0:o.orientation}))}}getBodyType(){let e=r.Body.DYNAMIC;return"STATIC"===this.bodyType?e=r.Body.STATIC:"KINEMATIC"===this.bodyType&&(e=r.Body.KINEMATIC),e}setPosition(e){var t;null===(t=this.rigidBody)||void 0===t||t.position.set(e.x,e.y,e.z)}updateShape(){var e,t,i;let r=null===(e=this.meshComponent)||void 0===e?void 0:e.getObject();if(!r)return;if(!this.shape)return;null===(t=this.rigidBody)||void 0===t||t.removeShape(this.shape);let o=n.threeToCannon(r);(null==o?void 0:o.shape)&&(this.shape=null==o?void 0:o.shape),this.shape&&(null===(i=this.rigidBody)||void 0===i||i.addShape(this.shape))}setQuaternion(e){var t;null===(t=this.rigidBody)||void 0===t||t.quaternion.set(e.x,e.y,e.z,e.w)}getPosition(){if(!this.rigidBody)return null;let e=new o.Position;return e.x=this.rigidBody.position.x,e.y=this.rigidBody.position.y,e.z=this.rigidBody.position.z,e}getQuaternion(){if(!this.rigidBody)return null;let e=new o.Quaternion;return e.x=this.rigidBody.quaternion.x,e.y=this.rigidBody.quaternion.y,e.z=this.rigidBody.quaternion.z,e.w=this.rigidBody.quaternion.w,e}getRigidBody(){return this.rigidBody}serialize(){return this.toObject()}deserialize(e){const t=e;this.mass=t.mass,this.bodyType=t.bodyType}toObject(){return{mass:this.mass,bodyType:this.bodyType}}}t.RigidBody=RigidBody},3515:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scale=void 0;t.Scale=class Scale{constructor(){this.x=0,this.y=0,this.z=0}serialize(){return this.toObject()}deserialize(e){const t=e;this.x=t.x,this.y=t.y,this.z=t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}},5646:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Time=void 0;class Time{}t.Time=Time,Time.deltaTime=0},1086:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=void 0;const r=i(293);class Transform extends r.Component{constructor(){super(...arguments),this.position=new r.Position,this.scale=new r.Scale,this.quaternion=new r.Quaternion,this.isFirstSynchronize=!0,this.rigidBody=null,this.renderableObject=null,this.onAwake=()=>{this.rigidBody=this.getComponent(r.RigidBody),this.renderableObject=this.getComponent(r.RenderableObject)},this.onUpdate=()=>{this.isFirstSynchronize&&(this.synchronizeTransform(),this.rigidBody&&(this.renderableObject&&this.renderableObject.setScale(this.scale),this.rigidBody.updateShape()),this.isFirstSynchronize=!1),this.updateTransform(),this.rigidBody&&this.synchronizeTransform()}}setPosition(e,t,i){this.position.x=e,this.position.y=t,this.position.z=i,this.isEnabled&&this.synchronizeTransform()}setScale(e,t,i){this.scale.x=e,this.scale.y=t,this.scale.z=i,this.isEnabled&&(this.renderableObject&&this.renderableObject.setScale(this.scale),this.rigidBody&&this.rigidBody.updateShape())}setQuaternion(e,t,i,r){this.quaternion.x=e,this.quaternion.y=t,this.quaternion.z=i,this.quaternion.w=r,this.isEnabled&&this.synchronizeTransform()}getPosition(){return this.position}getScale(){return this.scale}getQuaternion(){return this.quaternion}updateTransform(){if(this.rigidBody){var e=this.rigidBody.getPosition();e&&(this.position=e);var t=this.rigidBody.getQuaternion();t&&(this.quaternion=t)}if(this.renderableObject){var i=this.renderableObject.getScale();i&&(this.scale=i)}}synchronizeTransform(){this.renderableObject&&(this.renderableObject.setPosition(this.position),this.renderableObject.setQuaternion(this.quaternion)),this.rigidBody&&(this.rigidBody.setPosition(this.position),this.rigidBody.setQuaternion(this.quaternion))}serialize(){return this.toObject()}deserialize(e){const t=e;t.position&&this.position.deserialize(t.position),t.scale&&this.scale.deserialize(t.scale),t.quaternion&&this.quaternion.deserialize(t.quaternion)}toObject(){return{position:this.position.serialize(),scale:this.scale.serialize(),quaternion:this.quaternion.serialize()}}}t.Transform=Transform},6206:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameEditor=void 0;var r=i(7344);Object.defineProperty(t,"GameEditor",{enumerable:!0,get:function(){return r.GameEditor}})},7344:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameEditor=void 0;const r=i(5232),n=i(293),o=i(1265),a=i(8401),s=i(6648),d=i(6601),l=i(7093);let c=!1,h=!1,u=new r.Raycaster,m=new r.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,3e4),b=new r.WebGLRenderer,p=new s.TransformControls(m,b.domElement),y=null,f=new r.Group,g=new r.Scene;class GameEditor{constructor(e){this.lastTime=0,this.instanceLength=0,this.skyBox=new l.Skybox,this.update=e=>{if(requestAnimationFrame(this.update),n.Time.deltaTime=(e-this.lastTime)/1e3,this.lastTime=e,y&&y.update(),b.render(g,m),c){let e=0,t=new Array,i=new Array;n.GameObject.gameObjects.forEach((t=>{let r=t.serialize();if(null!=r){var n=++e+".json";o.ObjectSerializer.download(n,o.ObjectSerializer.serialize(r)),i.push("Assets/GameObject/"+n)}})),t.push({Skybox:this.skyBox.serialize()}),t.push({Instances:i}),o.ObjectSerializer.download("World.json",o.ObjectSerializer.serialize(t)),c=!1}h&&(n.GameObject.gameObjects.forEach((e=>{o.ObjectSerializer.readTextFile("Assets/"+e.constructor.name+".json",(t=>{t&&e.deserialize(o.ObjectSerializer.deserialize(t))}))})),h=!1),n.EventManager.getSystem().notify("Update"),n.EventManager.getSystem().notify("LateUpdate"),GameEditor.isFirstEvent&&n.GameObject.gameObjects.forEach((e=>{e.disable(),GameEditor.isFirstEvent=!1})),n.GameObject.gameObjects.forEach((e=>{var t=e.getComponent(n.Transform),i=e.getComponent(n.RenderableObject);if(t&&i){var r=i.getPosition();r&&t.setPosition(r.x,r.y,r.z);var o=i.getQuaternion();o&&t.setQuaternion(o.x,o.y,o.z,o.w);var a=i.getScale();a&&t.setScale(a.x,a.y,a.z)}}))},this.onDestroy=e=>{var t,i=null===(t=e.getComponent(n.RenderableObject))||void 0===t?void 0:t.getObject();i&&(p.detach(),y&&(y.enabled=!0),GameEditor.selectedGameObject=null,f.remove(i))},this.initRenderWorld(),this.initRenderer(),document.body.appendChild(b.domElement),this.deserialize(e),document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("click",this.onClick,!0),document.addEventListener("drop",this.onDrop),document.addEventListener("dragover",this.onDragOver),n.GameObject.event.subscribe("OnDestroy",this.onDestroy)}static remove(e){n.GameObject.destroy(e)}initRenderWorld(){m.position.z=50,g.fog=new r.Fog(0,500,1e4),g.add(m),g.add(p),g.add(f);const e=new r.AxesHelper(5);g.add(e)}initRenderer(){b.setSize(window.innerWidth,window.innerHeight),null!=g.fog&&b.setClearColor(g.fog.color),b.outputEncoding=r.sRGBEncoding}initEvents(){GameEditor.loadedGameObjects<this.instanceLength||(n.EventManager.getSystem().notify("Awake"),n.EventManager.getSystem().notify("Start"),y=new a.OrbitControls(m,b.domElement),y.update(),requestAnimationFrame(this.update),n.GameObject.gameObjects.forEach((e=>{GameEditor.draw(e)})))}static addFromDrag(e){var t=d.PrefabInstantiator.createInstance(e);t&&(GameEditor.isFirstEvent=!0,n.EventManager.getSystem().notify("Awake"),n.EventManager.getSystem().notify("Start"),GameEditor.draw(t))}addFromJSON(e){d.PrefabInstantiator.createInstanceFromJSON(e,(e=>{e&&(GameEditor.loadedGameObjects++,this.initEvents())}))}static draw(e){var t;let i=null===(t=e.getComponent(n.RenderableObject))||void 0===t?void 0:t.getObject();i&&g.add(i)}onKeyDown(e){if("t"==e.key)c=!0;else if("l"==e.key)h=!0;else if("g"==e.key)p.setMode("translate");else if("r"==e.key)p.setMode("rotate");else if("s"==e.key)p.setMode("scale");else if("d"==e.key){if(!GameEditor.selectedGameObject)return;GameEditor.remove(GameEditor.selectedGameObject)}}deserialize(e){o.ObjectSerializer.readTextFile(e,(e=>{if(!e)return;o.ObjectSerializer.deserialize(e).forEach((e=>{Object.keys(e).forEach((t=>{if("Skybox"==t){const r=e[t];this.skyBox.deserialize(r);var i=this.skyBox.getSkybox();i&&g.add(i)}else{const i=e[t];this.instanceLength=i.length,i.forEach((e=>{this.addFromJSON(e)}))}}))}))}))}onClick(e){var t=new r.Vector2;t.x=e.clientX/window.innerWidth*2-1,t.y=-e.clientY/window.innerHeight*2+1,u.setFromCamera(t,m),p.detach(),n.GameObject.gameObjects.forEach((e=>{var t,i=null===(t=e.getComponent(n.RenderableObject))||void 0===t?void 0:t.getObject();i&&f.add(i)}));var i=u.intersectObjects(f.children,!0);i.length>0?(p.attach(i[0].object),n.GameObject.gameObjects.forEach((e=>{var t;(null===(t=e.getComponent(n.RenderableObject))||void 0===t?void 0:t.getObject())==i[0].object&&(GameEditor.selectedGameObject=e)})),y&&(y.enabled=!1)):(GameEditor.selectedGameObject=null,y&&(y.enabled=!0))}onDrop(e){if(e.preventDefault(),e.dataTransfer){var t="";e.dataTransfer.items?[...e.dataTransfer.items].forEach(((e,i)=>{if("file"===e.kind){const r=e.getAsFile();r&&(t=(t=r.name).substring(0,t.lastIndexOf("."))||t),t&&console.log(`… file[${i}].name = ${t}`)}})):[...e.dataTransfer.files].forEach(((e,i)=>{t=(t=e.name).substring(0,t.lastIndexOf("."))||t,console.log(`… file[${i}].name = ${t}`)})),GameEditor.addFromDrag(t)}}onDragOver(e){e.preventDefault()}}t.GameEditor=GameEditor,GameEditor.loadedGameObjects=0,GameEditor.isFirstEvent=!0,GameEditor.selectedGameObject=null},8029:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DirectionalLight=t.AmbientLight=void 0;var r=i(3718);Object.defineProperty(t,"AmbientLight",{enumerable:!0,get:function(){return r.AmbientLight}});var n=i(2243);Object.defineProperty(t,"DirectionalLight",{enumerable:!0,get:function(){return n.DirectionalLight}})},3718:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AmbientLight=void 0;const r=i(5232),n=i(293);class AmbientLight extends n.RenderableObject{constructor(){super(...arguments),this.color=4210752,this.intensity=1,this.onAwake=()=>{this.object=new r.AmbientLight(this.color,this.intensity)}}serialize(){return this.toObject()}deserialize(e){const t=e;this.color=t.color,this.intensity=t.intensity}toObject(){return{color:this.color,intensity:this.intensity}}}t.AmbientLight=AmbientLight},2243:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DirectionalLight=void 0;const r=i(5232),n=i(293);class DirectionalLight extends n.RenderableObject{constructor(){super(...arguments),this.color=16777215,this.intensity=1,this.light=null,this.onAwake=()=>{this.light=new r.DirectionalLight(this.color,this.intensity)}}getObject(){return this.light}serialize(){return this.toObject()}deserialize(e){const t=e;this.color=t.color,this.intensity=t.intensity}toObject(){return{color:this.color,intensity:this.intensity}}}t.DirectionalLight=DirectionalLight},2967:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SphereMesh=t.BoxMesh=void 0;var r=i(5664);Object.defineProperty(t,"BoxMesh",{enumerable:!0,get:function(){return r.BoxMesh}});var n=i(7030);Object.defineProperty(t,"SphereMesh",{enumerable:!0,get:function(){return n.SphereMesh}})},5664:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BoxMesh=void 0;const r=i(5232),n=i(293);class BoxMesh extends n.Mesh{constructor(){super(...arguments),this.width=50,this.height=5,this.depth=50,this.geometry=null,this.material=null,this.onAwake=()=>{this.geometry=new r.BoxGeometry(this.width,this.height,this.depth),this.material=new r.MeshStandardMaterial({color:9849600}),this.object=new r.Mesh(this.geometry,this.material)}}serialize(){return this.toObject()}deserialize(e){const t=e;this.width=t.width,this.height=t.height,this.depth=t.depth}toObject(){return{width:this.width,height:this.height,depth:this.depth}}}t.BoxMesh=BoxMesh},7030:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SphereMesh=void 0;const r=i(5232),n=i(293);class SphereMesh extends n.Mesh{constructor(){super(...arguments),this.radius=3,this.geometry=null,this.material=null,this.onAwake=()=>{this.geometry=new r.SphereGeometry(this.radius),this.material=new r.MeshStandardMaterial({color:13697024}),this.object=new r.Mesh(this.geometry,this.material)}}serialize(){return this.toObject()}deserialize(e){const t=e;this.radius=t.radius}toObject(){return{radius:this.radius}}}t.SphereMesh=SphereMesh},7158:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RotateDirection=t.Mover=t.MoveDirection=void 0;var r=i(1193);Object.defineProperty(t,"MoveDirection",{enumerable:!0,get:function(){return r.MoveDirection}});var n=i(8598);Object.defineProperty(t,"Mover",{enumerable:!0,get:function(){return n.Mover}});var o=i(4505);Object.defineProperty(t,"RotateDirection",{enumerable:!0,get:function(){return o.RotateDirection}})},1193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MoveDirection=void 0,function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward",e[e.None=0]="None"}(t.MoveDirection||(t.MoveDirection={}))},8598:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mover=void 0;const r=i(9542),n=i(293),o=i(7158);class Mover extends n.Component{constructor(){super(...arguments),this.acceleration=20,this.deceleration=2,this.maxSpeed=20,this.rotateSpeed=90,this.jumpForce=20,this.angle=Math.PI/2,this.currentSpeed=0,this.moveDirection=o.MoveDirection.None,this.rotateDirection=o.RotateDirection.None,this.rigidBodyComponent=null,this.onAwake=()=>{this.rigidBodyComponent=this.getComponent(n.RigidBody)},this.onUpdate=()=>{this.move(),this.rotate()}}startMove(e){this.moveDirection=e}stopMove(){this.moveDirection=o.MoveDirection.None}startRotate(e){this.rotateDirection=e}stopRotate(){this.rotateDirection=o.RotateDirection.None}jump(){if(this.rigidBodyComponent){var e=this.rigidBodyComponent.getRigidBody();e&&(e.velocity.y=this.jumpForce)}}move(){if(this.rigidBodyComponent){var e=this.rigidBodyComponent.getRigidBody();e&&(this.moveDirection==o.MoveDirection.Forward?this.currentSpeed=(0,r.clamp)(this.currentSpeed+this.acceleration*n.Time.deltaTime,this.currentSpeed,this.maxSpeed):this.moveDirection==o.MoveDirection.Backward?this.currentSpeed=(0,r.clamp)(this.currentSpeed-this.acceleration*n.Time.deltaTime,-this.maxSpeed,this.currentSpeed):this.currentSpeed>0?this.currentSpeed=(0,r.clamp)(this.currentSpeed-this.deceleration*n.Time.deltaTime,0,this.currentSpeed):this.currentSpeed=(0,r.clamp)(this.currentSpeed+this.deceleration*n.Time.deltaTime,this.currentSpeed,0),e.velocity.x=this.currentSpeed)}}rotate(){this.angle+=this.rotateDirection*Math.PI/180*Math.abs(this.currentSpeed/this.maxSpeed)*this.rotateSpeed*n.Time.deltaTime}serialize(){return this.toObject()}deserialize(e){const t=e;this.acceleration=t.acceleration,this.deceleration=t.deceleration,this.maxSpeed=t.maxSpeed,this.rotateSpeed=t.rotateSpeed,this.jumpForce=t.jumpForce}toObject(){return{acceleration:this.acceleration,deceleration:this.deceleration,maxSpeed:this.maxSpeed,rotateSpeed:this.rotateSpeed,jumpForce:this.jumpForce}}}t.Mover=Mover},4505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RotateDirection=void 0,function(e){e[e.Right=1]="Right",e[e.Left=-1]="Left",e[e.None=0]="None"}(t.RotateDirection||(t.RotateDirection={}))},6601:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PrefabInstantiator=t.FollowCameraPrefab=t.FloorPrefab=t.DirectionalLightPrefab=t.BallPrefab=t.AmbientLightPrefab=void 0;var r=i(8264);Object.defineProperty(t,"AmbientLightPrefab",{enumerable:!0,get:function(){return r.AmbientLightPrefab}});var n=i(8744);Object.defineProperty(t,"BallPrefab",{enumerable:!0,get:function(){return n.BallPrefab}});var o=i(4879);Object.defineProperty(t,"DirectionalLightPrefab",{enumerable:!0,get:function(){return o.DirectionalLightPrefab}});var a=i(4483);Object.defineProperty(t,"FloorPrefab",{enumerable:!0,get:function(){return a.FloorPrefab}});var s=i(9648);Object.defineProperty(t,"FollowCameraPrefab",{enumerable:!0,get:function(){return s.FollowCameraPrefab}});var d=i(3261);Object.defineProperty(t,"PrefabInstantiator",{enumerable:!0,get:function(){return d.PrefabInstantiator}})},8264:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AmbientLightPrefab=void 0;const r=i(293),n=i(8029);class AmbientLightPrefab extends r.GameObject{constructor(){super(...arguments),this.name="AmbientLightPrefab"}addComponents(){this.addComponent(new n.AmbientLight)}}t.AmbientLightPrefab=AmbientLightPrefab},8744:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BallPrefab=void 0;const r=i(293),n=i(2508),o=i(7158),a=i(2967);class BallPrefab extends r.GameObject{constructor(){super(...arguments),this.name="BallPrefab"}addComponents(){this.addComponent(new a.SphereMesh),this.addComponent(new r.RigidBody),this.addComponent(new n.PlayerController),this.addComponent(new o.Mover)}}t.BallPrefab=BallPrefab},4879:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DirectionalLightPrefab=void 0;const r=i(293),n=i(8029);class DirectionalLightPrefab extends r.GameObject{constructor(){super(...arguments),this.name="DirectionalLightPrefab"}addComponents(){this.addComponent(new n.DirectionalLight)}}t.DirectionalLightPrefab=DirectionalLightPrefab},4483:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FloorPrefab=void 0;const r=i(293),n=i(2967);class FloorPrefab extends r.GameObject{constructor(){super(...arguments),this.name="FloorPrefab"}addComponents(){this.addComponent(new n.BoxMesh),this.addComponent(new r.RigidBody)}}t.FloorPrefab=FloorPrefab},9648:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FollowCameraPrefab=void 0;const r=i(4400),n=i(293);class FollowCameraPrefab extends n.GameObject{constructor(){super(...arguments),this.name="FollowCameraPrefab",this.tag="MainCamera"}addComponents(){this.addComponent(new r.PerspectiveCamera),this.addComponent(new r.FollowCamera)}}t.FollowCameraPrefab=FollowCameraPrefab},3261:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PrefabInstantiator=void 0;const r=i(6601),n=i(1265);t.PrefabInstantiator=class PrefabInstantiator{static setupInstance(e){e.setup()}static createInstance(e){var t;switch(e){case"AmbientLightPrefab":t=new r.AmbientLightPrefab;break;case"BallPrefab":t=new r.BallPrefab;break;case"DirectionalLightPrefab":t=new r.DirectionalLightPrefab;break;case"FloorPrefab":t=new r.FloorPrefab;break;case"FollowCameraPrefab":t=new r.FollowCameraPrefab;break;default:return null}return this.setupInstance(t),t}static createInstanceFromJSON(e,t){n.ObjectSerializer.readTextFile(e,(e=>{if(e){var i=null,r=n.ObjectSerializer.deserialize(e);if(r.forEach((e=>{Object.keys(e).forEach((t=>{if("GameObject"==t){const r=e[t];i=r.prefab}}))})),i){var o=this.createInstance(i);null==o||o.deserialize(r),t(o)}else t(null)}else t(null)}))}}},1265:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectSerializer=void 0;var r=i(7128);Object.defineProperty(t,"ObjectSerializer",{enumerable:!0,get:function(){return r.ObjectSerializer}})},7128:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectSerializer=void 0;t.ObjectSerializer=class ObjectSerializer{static serialize(e){return JSON.stringify(e)}static deserialize(e){return JSON.parse(e)}static download(e,t){var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}static readTextFile(e,t){fetch(e,{method:"GET",mode:"no-cors"}).then((function(i){if(200==i.status)return i.text();console.log(e+" doesn't exist!"),t(null)})).then((e=>{e&&t(e)})).catch((function(e){console.log("Error ",e)}))}}},7093:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Skybox=t.GameWorld=void 0;var r=i(3626);Object.defineProperty(t,"GameWorld",{enumerable:!0,get:function(){return r.GameWorld}});var n=i(7887);Object.defineProperty(t,"Skybox",{enumerable:!0,get:function(){return n.Skybox}})},3626:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameWorld=void 0;const r=i(3687),n=i(5232),o=i(293),a=i(1265),s=i(4400),d=i(6601),l=i(7093);t.GameWorld=class GameWorld{constructor(e){this.camera=null,this.renderWorld=new n.Scene,this.physicWorld=new r.World({gravity:new r.Vec3(0,-20,0)}),this.renderer=new n.WebGLRenderer,this.skyBox=new l.Skybox,this.lastTime=0,this.instanceLength=0,this.gameObjects=new Array,this.loadedGameObjects=0,this.update=e=>{var t;requestAnimationFrame(this.update),o.Time.deltaTime=(e-this.lastTime)/1e3,this.lastTime=e,this.physicWorld.fixedStep();var i=null===(t=this.camera)||void 0===t?void 0:t.getCamera();i&&this.renderer.render(this.renderWorld,i),o.EventManager.getSystem().notify("Update"),o.EventManager.getSystem().notify("LateUpdate")},"string"!=typeof e&&(this.instanceLength=e.length),this.initRenderWorld(),this.initPhysicWorld(),this.initRenderer(),document.body.appendChild(this.renderer.domElement),"string"==typeof e?this.deserialize(e):e.forEach((e=>{"string"==typeof e?this.addFromJSON(e):this.add(e)}))}initRenderWorld(){this.renderWorld.fog=new n.Fog(0,500,1e4)}initPhysicWorld(){this.physicWorld.defaultContactMaterial.restitution=.5}initRenderer(){this.renderer.setSize(window.innerWidth,window.innerHeight),null!=this.renderWorld.fog&&this.renderer.setClearColor(this.renderWorld.fog.color),this.renderer.outputEncoding=n.sRGBEncoding}initEvents(){var e;this.loadedGameObjects<this.instanceLength||(o.EventManager.getSystem().notify("Awake"),o.EventManager.getSystem().notify("Start"),this.camera=null===(e=o.GameObject.findWithTag("MainCamera"))||void 0===e?void 0:e.getComponent(s.PerspectiveCamera),requestAnimationFrame(this.update),this.gameObjects.forEach((e=>{this.draw(e)})))}add(e){d.PrefabInstantiator.setupInstance(e),this.gameObjects.push(e),this.loadedGameObjects++,this.initEvents()}addFromJSON(e){d.PrefabInstantiator.createInstanceFromJSON(e,(e=>{e&&(this.gameObjects.push(e),this.loadedGameObjects++,this.initEvents())}))}draw(e){var t,i;let r=null===(t=e.getComponent(o.RenderableObject))||void 0===t?void 0:t.getObject();r&&this.renderWorld.add(r);let n=null===(i=e.getComponent(o.RigidBody))||void 0===i?void 0:i.getRigidBody();n&&this.physicWorld.addBody(n)}deserialize(e){a.ObjectSerializer.readTextFile(e,(e=>{if(!e)return;a.ObjectSerializer.deserialize(e).forEach((e=>{Object.keys(e).forEach((t=>{if("Skybox"==t){const r=e[t];this.skyBox.deserialize(r);var i=this.skyBox.getSkybox();i&&this.renderWorld.add(i)}else{const i=e[t];this.instanceLength=i.length,i.forEach((e=>{this.addFromJSON(e)}))}}))}))}))}}},7887:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Skybox=void 0;const r=i(5232);t.Skybox=class Skybox{constructor(){this.skyboxFilePath="Assets/Skybox/corona",this.side=1e4,this.geometry=null,this.object=null}getSkybox(){return this.object}createMaterialArray(e){return this.createPathStrings(e).map((e=>{let t=(new r.TextureLoader).load(e);return new r.MeshBasicMaterial({map:t,side:r.BackSide})}))}createPathStrings(e){return["ft","bk","up","dn","rt","lf"].map((t=>e+"_"+t+".png"))}serialize(){return this.toObject()}deserialize(e){const t=e;this.skyboxFilePath=t.skyboxFilePath,this.side=t.side,this.geometry=new r.BoxGeometry(this.side,this.side,this.side),this.object=new r.Mesh(this.geometry,this.createMaterialArray(this.skyboxFilePath))}toObject(){return{skyboxFilePath:this.skyboxFilePath,side:this.side}}}}},i={};function r(e){var n=i[e];if(void 0!==n)return n.exports;var o=i[e]={exports:{}};return t[e].call(o.exports,o,o.exports,r),o.exports}r.m=t,e=[],r.O=(t,i,n,o)=>{if(!i){var a=1/0;for(c=0;c<e.length;c++){for(var[i,n,o]=e[c],s=!0,d=0;d<i.length;d++)(!1&o||a>=o)&&Object.keys(r.O).every((e=>r.O[e](i[d])))?i.splice(d--,1):(s=!1,o<a&&(a=o));if(s){e.splice(c--,1);var l=n();void 0!==l&&(t=l)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[i,n,o]},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};r.O.j=t=>0===e[t];var t=(t,i)=>{var n,o,[a,s,d]=i,l=0;if(a.some((t=>0!==e[t]))){for(n in s)r.o(s,n)&&(r.m[n]=s[n]);if(d)var c=d(r)}for(t&&t(i);l<a.length;l++)o=a[l],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(c)},i=self.webpackChunk=self.webpackChunk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=r.O(void 0,[679],(()=>r(6330)));n=r.O(n)})();