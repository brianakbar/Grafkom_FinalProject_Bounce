(()=>{"use strict";var e,t={6330:(e,t,r)=>{const i=r(6601),o=r(7093);let n=new Array;n.push(new i.BallPrefab),n.push(new i.FloorPrefab),new o.GameWorld(n)},2508:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerController=void 0;var i=r(4999);Object.defineProperty(t,"PlayerController",{enumerable:!0,get:function(){return i.PlayerController}})},4999:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlayerController=void 0;const i=r(293),o=r(7158);let n=!1,s=!1,a=!1,d=!1,h=!1;class PlayerController extends i.Component{constructor(){super(...arguments),this.onAwake=()=>{document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1),this.mover=this.getComponent(o.Mover)},this.onUpdate=()=>{null!=this.mover&&(n?this.mover.startMove(o.MoveDirection.Forward):a?this.mover.startMove(o.MoveDirection.Backward):this.mover.stopMove(),d?this.mover.startRotate(o.RotateDirection.Right):s?this.mover.startRotate(o.RotateDirection.Left):this.mover.stopRotate(),h&&(this.mover.jump(),h=!1))}}onKeyDown(e){"w"==e.key?n=!0:"s"==e.key?a=!0:"a"==e.key?s=!0:"d"==e.key?d=!0:" "==e.key&&(h=!0)}onKeyUp(e){"w"==e.key?n=!1:"s"==e.key?a=!1:"a"==e.key?s=!1:"d"==e.key&&(d=!1)}}t.PlayerController=PlayerController},293:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=t.Time=t.BoxMesh=t.SphereMesh=t.RigidBody=t.Mesh=t.GameObject=t.EventManager=t.Component=void 0;var i=r(8755);Object.defineProperty(t,"Component",{enumerable:!0,get:function(){return i.Component}});var o=r(4309);Object.defineProperty(t,"EventManager",{enumerable:!0,get:function(){return o.EventManager}});var n=r(6350);Object.defineProperty(t,"GameObject",{enumerable:!0,get:function(){return n.GameObject}});var s=r(4165);Object.defineProperty(t,"Mesh",{enumerable:!0,get:function(){return s.Mesh}});var a=r(5983);Object.defineProperty(t,"RigidBody",{enumerable:!0,get:function(){return a.RigidBody}});var d=r(4011);Object.defineProperty(t,"SphereMesh",{enumerable:!0,get:function(){return d.SphereMesh}});var h=r(7251);Object.defineProperty(t,"BoxMesh",{enumerable:!0,get:function(){return h.BoxMesh}});var l=r(5646);Object.defineProperty(t,"Time",{enumerable:!0,get:function(){return l.Time}});var c=r(1086);Object.defineProperty(t,"Transform",{enumerable:!0,get:function(){return c.Transform}})},7251:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BoxMesh=void 0;const i=r(5232),o=r(293);class BoxMesh extends o.Mesh{constructor(){super(...arguments),this.width=50,this.height=5,this.depth=50,this.geometry=null,this.material=null,this.onAwake=()=>{this.geometry=new i.BoxGeometry(this.width,this.height,this.depth),this.material=new i.MeshBasicMaterial({color:9849600}),this.mesh=new i.Mesh(this.geometry,this.material)}}serialize(){return this.toObject()}deserialize(e){const t=e;this.width=t.width,this.height=t.height,this.depth=t.depth}toObject(){return{width:this.width,height:this.height,depth:this.depth}}}t.BoxMesh=BoxMesh},8755:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;const i=r(293);t.Component=class Component{constructor(){this.gameObject=new i.GameObject,this.onAwake=()=>{},this.onStart=()=>{},this.onUpdate=()=>{}}setup(e){this.gameObject=e,i.EventManager.getSystem().subscribe("Awake",this.onAwake),i.EventManager.getSystem().subscribe("Start",this.onStart),i.EventManager.getSystem().subscribe("Update",this.onUpdate)}getComponent(e){return this.gameObject.getComponent(e)}serialize(){return null}deserialize(e){}}},4309:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=void 0;const i=r(8675);t.EventManager=class EventManager{static getSystem(){return this.eventSystem||(this.eventSystem=new i.default),this.eventSystem}}},6350:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameObject=void 0;const i=r(293);class GameObject{constructor(){this.name="GameObject",this.components=new Array}setup(){GameObject.gameObjects.push(this),this.addComponents()}getComponent(e){let t=null;return this.components.forEach((r=>{let o=Object.getPrototypeOf(r);for(;o instanceof i.Component;)o.constructor.name===e.name&&(t=r),o=Object.getPrototypeOf(o)})),t||null}addComponent(e){e.setup(this),this.components.push(e)}serialize(){let e=new Array;return this.components.forEach((t=>{let r=t.serialize();r&&e.push({[t.constructor.name]:r})})),e.length>0?e:null}deserialize(e){e.forEach((e=>{Object.keys(e).forEach((t=>{var r;null===(r=this.getComponentByString(t))||void 0===r||r.deserialize(e[t])}))}))}getComponentByString(e){let t=null;return this.components.forEach((r=>{r.constructor.name===e&&(t=r)})),t||null}draw(){}addComponents(){}}t.GameObject=GameObject,GameObject.gameObjects=new Array},4165:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mesh=void 0;const i=r(293);class Mesh extends i.Component{constructor(){super(...arguments),this.mesh=null}getMesh(){return this.mesh}setPosition(e,t,r){var i;null===(i=this.mesh)||void 0===i||i.position.set(e,t,r)}setQuaternion(e,t,r,i){var o;null===(o=this.mesh)||void 0===o||o.quaternion.set(e,t,r,i)}}t.Mesh=Mesh},5983:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RigidBody=void 0;const i=r(3687),o=r(5264),n=r(293);class RigidBody extends n.Component{constructor(){super(...arguments),this.mass=0,this.x=0,this.y=0,this.z=0,this.bodyType="DYNAMIC",this.rigidBody=null,this.meshComponent=null,this.onAwake=()=>{this.meshComponent=this.getComponent(n.Mesh)},this.onStart=()=>{var e;let t=null===(e=this.meshComponent)||void 0===e?void 0:e.getMesh();if(!t)return;let r=i.Body.DYNAMIC;"STATIC"===this.bodyType?r=i.Body.STATIC:"KINEMATIC"===this.bodyType&&(r=i.Body.KINEMATIC);let n=o.threeToCannon(t);this.rigidBody=new i.Body({mass:this.mass,type:r,shape:null==n?void 0:n.shape,position:null==n?void 0:n.offset,quaternion:null==n?void 0:n.orientation}),this.rigidBody.position.set(this.x,this.y,this.z)},this.onUpdate=()=>{var e,t;this.rigidBody&&(null===(e=this.meshComponent)||void 0===e||e.setPosition(this.rigidBody.position.x,this.rigidBody.position.y,this.rigidBody.position.z),null===(t=this.meshComponent)||void 0===t||t.setQuaternion(this.rigidBody.quaternion.x,this.rigidBody.quaternion.y,this.rigidBody.quaternion.z,this.rigidBody.quaternion.w))}}getRigidBody(){return this.rigidBody}serialize(){return this.toObject()}deserialize(e){const t=e;this.mass=t.mass,this.x=t.x,this.y=t.y,this.z=t.z,this.bodyType=t.bodyType}toObject(){return{mass:this.mass,x:this.x,y:this.y,z:this.z,bodyType:this.bodyType}}}t.RigidBody=RigidBody},4011:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SphereMesh=void 0;const i=r(5232),o=r(293);class SphereMesh extends o.Mesh{constructor(){super(...arguments),this.radius=3,this.geometry=null,this.material=null,this.onAwake=()=>{this.geometry=new i.SphereGeometry(this.radius),this.material=new i.MeshBasicMaterial({color:13697024}),this.mesh=new i.Mesh(this.geometry,this.material)}}serialize(){return this.toObject()}deserialize(e){const t=e;this.radius=t.radius}toObject(){return{radius:this.radius}}}t.SphereMesh=SphereMesh},5646:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Time=void 0;class Time{}t.Time=Time,Time.deltaTime=0},1086:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=void 0;const i=r(5232),o=r(293);class Transform extends o.Component{constructor(){super(...arguments),this.position=new i.Vector3,this.rotation=new i.Quaternion}}t.Transform=Transform},7158:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RotateDirection=t.Mover=t.MoveDirection=void 0;var i=r(1193);Object.defineProperty(t,"MoveDirection",{enumerable:!0,get:function(){return i.MoveDirection}});var o=r(8598);Object.defineProperty(t,"Mover",{enumerable:!0,get:function(){return o.Mover}});var n=r(4505);Object.defineProperty(t,"RotateDirection",{enumerable:!0,get:function(){return n.RotateDirection}})},1193:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MoveDirection=void 0,function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward",e[e.None=0]="None"}(t.MoveDirection||(t.MoveDirection={}))},8598:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Mover=void 0;const i=r(9542),o=r(293),n=r(7158);class Mover extends o.Component{constructor(){super(...arguments),this.acceleration=20,this.deceleration=2,this.maxSpeed=20,this.rotateSpeed=90,this.jumpForce=20,this.angle=Math.PI/2,this.currentSpeed=0,this.moveDirection=n.MoveDirection.None,this.rotateDirection=n.RotateDirection.None,this.rigidBodyComponent=null,this.onAwake=()=>{this.rigidBodyComponent=this.getComponent(o.RigidBody)},this.onUpdate=()=>{this.move(),this.rotate()}}startMove(e){this.moveDirection=e}stopMove(){this.moveDirection=n.MoveDirection.None}startRotate(e){this.rotateDirection=e}stopRotate(){this.rotateDirection=n.RotateDirection.None}jump(){if(this.rigidBodyComponent){var e=this.rigidBodyComponent.getRigidBody();e&&(e.velocity.y=this.jumpForce)}}move(){if(this.rigidBodyComponent){var e=this.rigidBodyComponent.getRigidBody();if(e){this.moveDirection==n.MoveDirection.Forward?this.currentSpeed=(0,i.clamp)(this.currentSpeed+this.acceleration*o.Time.deltaTime,this.currentSpeed,this.maxSpeed):this.moveDirection==n.MoveDirection.Backward?this.currentSpeed=(0,i.clamp)(this.currentSpeed-this.acceleration*o.Time.deltaTime,-this.maxSpeed,this.currentSpeed):this.currentSpeed>0?this.currentSpeed=(0,i.clamp)(this.currentSpeed-this.deceleration*o.Time.deltaTime,0,this.currentSpeed):this.currentSpeed=(0,i.clamp)(this.currentSpeed+this.deceleration*o.Time.deltaTime,this.currentSpeed,0);var t=this.currentSpeed*Math.sin(this.angle),r=this.currentSpeed*Math.cos(this.angle);e.velocity.z=t,e.velocity.x=r}}}rotate(){this.angle+=this.rotateDirection*Math.PI/180*Math.abs(this.currentSpeed/this.maxSpeed)*this.rotateSpeed*o.Time.deltaTime}serialize(){return this.toObject()}deserialize(e){const t=e;this.acceleration=t.acceleration,this.deceleration=t.deceleration,this.maxSpeed=t.maxSpeed,this.rotateSpeed=t.rotateSpeed,this.jumpForce=t.jumpForce}toObject(){return{acceleration:this.acceleration,deceleration:this.deceleration,maxSpeed:this.maxSpeed,rotateSpeed:this.rotateSpeed,jumpForce:this.jumpForce}}}t.Mover=Mover},4505:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RotateDirection=void 0,function(e){e[e.Right=1]="Right",e[e.Left=-1]="Left",e[e.None=0]="None"}(t.RotateDirection||(t.RotateDirection={}))},6601:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FloorPrefab=t.BallPrefab=void 0;var i=r(8744);Object.defineProperty(t,"BallPrefab",{enumerable:!0,get:function(){return i.BallPrefab}});var o=r(4483);Object.defineProperty(t,"FloorPrefab",{enumerable:!0,get:function(){return o.FloorPrefab}})},8744:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BallPrefab=void 0;const i=r(293),o=r(2508),n=r(7158);class BallPrefab extends i.GameObject{constructor(){super(...arguments),this.name="BallPrefab"}addComponents(){this.addComponent(new i.SphereMesh),this.addComponent(new i.RigidBody),this.addComponent(new o.PlayerController),this.addComponent(new n.Mover)}}t.BallPrefab=BallPrefab},4483:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FloorPrefab=void 0;const i=r(293);class FloorPrefab extends i.GameObject{constructor(){super(...arguments),this.name="FloorPrefab"}addComponents(){this.addComponent(new i.BoxMesh),this.addComponent(new i.RigidBody)}}t.FloorPrefab=FloorPrefab},1265:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectSerializer=void 0;var i=r(7128);Object.defineProperty(t,"ObjectSerializer",{enumerable:!0,get:function(){return i.ObjectSerializer}})},7128:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectSerializer=void 0;t.ObjectSerializer=class ObjectSerializer{static serialize(e){return JSON.stringify(e)}static deserialize(e){return JSON.parse(e)}static download(e,t){var r=document.createElement("a");r.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),r.setAttribute("download",e),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}static readTextFile(e,t){var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.onerror=function(){404==r.status&&t(null)},r.onreadystatechange=function(){4===r.readyState&&200==r.status&&t(r.responseText)},r.send(null)}}},7093:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameWorld=void 0;var i=r(3626);Object.defineProperty(t,"GameWorld",{enumerable:!0,get:function(){return i.GameWorld}})},3626:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GameWorld=void 0;const i=r(3687),o=r(5232),n=r(293),s=r(3094),a=r(1265);let d=!1,h=!1;t.GameWorld=class GameWorld{constructor(e){this.camera=new o.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e3),this.renderWorld=new o.Scene,this.physicWorld=new i.World({gravity:new i.Vec3(0,-20,0)}),this.renderer=new o.WebGLRenderer,this.lastTime=0,this.loadedGameObjects=0,this.update=e=>{requestAnimationFrame(this.update),n.Time.deltaTime=(e-this.lastTime)/1e3,this.lastTime=e,this.control.update(),this.physicWorld.fixedStep(),this.renderer.render(this.renderWorld,this.camera),d&&(n.GameObject.gameObjects.forEach((e=>{let t=e.serialize();null!=t&&a.ObjectSerializer.download(e.constructor.name+".json",a.ObjectSerializer.serialize(t))})),d=!1),h&&(n.GameObject.gameObjects.forEach((e=>{a.ObjectSerializer.readTextFile("Assets/"+e.constructor.name+".json",(t=>{t&&e.deserialize(a.ObjectSerializer.deserialize(t))}))})),h=!1),n.EventManager.getSystem().notify("Update")},this.camera.position.z=25,this.initRenderWorld(),this.initPhysicWorld(),this.initRenderer(),document.body.appendChild(this.renderer.domElement),this.control=new s.OrbitControls(this.camera,this.renderer.domElement),this.control.update(),e.forEach((e=>{this.add(e)})),document.addEventListener("keydown",this.onKeyDown,!1),this.gameObjects=e}add(e){e.setup(),a.ObjectSerializer.readTextFile("Assets/"+e.constructor.name+".json",(t=>{t&&e.deserialize(a.ObjectSerializer.deserialize(t)),this.loadedGameObjects++,this.initEvents()}))}draw(e){var t,r;let i=null===(t=e.getComponent(n.Mesh))||void 0===t?void 0:t.getMesh();i&&this.renderWorld.add(i);let o=null===(r=e.getComponent(n.RigidBody))||void 0===r?void 0:r.getRigidBody();o&&this.physicWorld.addBody(o)}initRenderWorld(){this.renderWorld.fog=new o.Fog(0,500,1e4);const e=new o.AmbientLight(4210752,1);this.renderWorld.add(e);const t=new o.AxesHelper(5);this.renderWorld.add(t)}initPhysicWorld(){this.physicWorld.defaultContactMaterial.restitution=.5}initRenderer(){this.renderer.setSize(window.innerWidth,window.innerHeight),null!=this.renderWorld.fog&&this.renderer.setClearColor(this.renderWorld.fog.color),this.renderer.outputEncoding=o.sRGBEncoding}initEvents(){this.loadedGameObjects<this.gameObjects.length||(n.EventManager.getSystem().notify("Awake"),n.EventManager.getSystem().notify("Start"),requestAnimationFrame(this.update),this.gameObjects.forEach((e=>{this.draw(e)})))}onKeyDown(e){"t"==e.key?d=!0:"l"==e.key&&(h=!0)}}}},r={};function i(e){var o=r[e];if(void 0!==o)return o.exports;var n=r[e]={exports:{}};return t[e].call(n.exports,n,n.exports,i),n.exports}i.m=t,e=[],i.O=(t,r,o,n)=>{if(!r){var s=1/0;for(l=0;l<e.length;l++){for(var[r,o,n]=e[l],a=!0,d=0;d<r.length;d++)(!1&n||s>=n)&&Object.keys(i.O).every((e=>i.O[e](r[d])))?r.splice(d--,1):(a=!1,n<s&&(s=n));if(a){e.splice(l--,1);var h=o();void 0!==h&&(t=h)}}return t}n=n||0;for(var l=e.length;l>0&&e[l-1][2]>n;l--)e[l]=e[l-1];e[l]=[r,o,n]},i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,r)=>{var o,n,[s,a,d]=r,h=0;if(s.some((t=>0!==e[t]))){for(o in a)i.o(a,o)&&(i.m[o]=a[o]);if(d)var l=d(i)}for(t&&t(r);h<s.length;h++)n=s[h],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(l)},r=self.webpackChunk=self.webpackChunk||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var o=i.O(void 0,[491],(()=>i(6330)));o=i.O(o)})();